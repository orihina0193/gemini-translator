<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini ç¿»è¨³ãƒ„ãƒ¼ãƒ«</title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ã€ãƒ¢ãƒ€ãƒ³ãªã‚¹ã‚¿ã‚¤ãƒ«ã‚’æä¾›ã—ã¾ã™ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’å…¨ä½“ã«é©ç”¨ã—ã€åŸºæœ¬çš„ãªèƒŒæ™¯è‰²ã¨ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’è¨­å®š */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* ãƒ€ãƒ¼ã‚¯ãªèƒŒæ™¯è‰² */
            color: #e2e8f0; /* æ˜ã‚‹ã„ãƒ†ã‚­ã‚¹ãƒˆè‰² */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align content from top */
            min-height: 100vh;
            padding: 1.5rem;
            padding-bottom: 6rem; /* Increased padding at bottom to avoid menu bar overlap */
        }
        /* ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŸºæœ¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ« */
        .card {
            background-color: #2d3748; /* ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰² */
            border-radius: 1rem; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* è»½ã„å½± */
            padding: 2rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—ã‚„ã™ */
            width: 100%;
            max-width: 38rem; /* å¹…ã‚’åºƒã’ã¦è¦‹ã‚„ã™ã */
            animation: fadeIn 0.8s ease-out; /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn {
            background-color: #4299e1; /* é’ç³»ã®ãƒœã‚¿ãƒ³è‰² */
            color: white; /* ç™½ã„æ–‡å­—è‰² */
            padding: 0.75rem 1.5rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
            border-radius: 0.75rem; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
            font-weight: 600; /* å¤ªã‚ã®ãƒ•ã‚©ãƒ³ãƒˆ */
            transition: background-color 0.3s ease; /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }
        .btn:hover {
            background-color: #3182ce; /* ãƒ›ãƒãƒ¼æ™‚ã®è‰² */
        }
        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        textarea {
            background-color: #1a202c; /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®èƒŒæ™¯è‰² */
            color: #e2e8f0; /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®æ–‡å­—è‰² */
            border-color: #4a5568; /* ãƒœãƒ¼ãƒ€ãƒ¼è‰² */
            border-radius: 0.5rem; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
            resize: vertical; /* ç¸¦æ–¹å‘ã®ã¿ãƒªã‚µã‚¤ã‚ºå¯èƒ½ */
            min-height: 12rem; /* ã•ã‚‰ã«å¤§ããã—ãŸæœ€å°é«˜ã• for input */
            padding: 1rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ  */
        }
        textarea#outputText { /* Specific style for output textarea */
            min-height: 14rem; /* ã•ã‚‰ã«å¤§ããã—ãŸæœ€å°é«˜ã• for output */
        }
        textarea:focus {
            outline: none;
            border-color: #60a5fa; /* Blue-400: ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®è‰² */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.4);
        }
        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2d3748;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
        }
        .message-box.show {
            display: block; /* è¡¨ç¤ºæ™‚ã«è¡¨ç¤º */
        }
        .message-box button {
            margin-top: 1rem;
            background-color: #4299e1;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        /* ãƒ­ãƒ¼ãƒ‰ä¸­ã®ã‚¹ãƒ”ãƒŠãƒ¼ */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4299e1;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            animation: spin 1s linear infinite;
            display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
            margin: 1.5rem auto;
        }
        .spinner.show {
            display: block; /* è¡¨ç¤ºæ™‚ã«è¡¨ç¤º */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Instruction text below input */
        .instruction-text {
            color: #94a3b8; /* Slate-400 */
            font-size: 0.95rem;
            text-align: center;
            margin-top: 0.75rem;
        }
    </style>
</head>
<body>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ -->
    <div id="messageBox" class="message-box">
        <p id="messageText" class="text-lg mb-2"></p>
        <button onclick="hideMessageBox()">OK</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã®ç¿»è¨³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ -->
    <div class="card">
        <h1 class="text-3xl font-bold text-center mb-6">Gemini ç¿»è¨³ãƒ„ãƒ¼ãƒ«</h1>

        <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="mb-6">
            <label for="inputText" class="block text-xl font-medium mb-3">ğŸ“ ç¿»è¨³ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ:</label>
            <textarea id="inputText" rows="6" class="w-full text-lg" placeholder="ã“ã“ã«ç¿»è¨³ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
            <p id="instructionMessage" class="instruction-text mt-3">
                â¬†ï¸ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ã‹ã‚‰ã€ã€Œç¿»è¨³ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
            </p>
        </div>

        <!-- ãƒœã‚¿ãƒ³ã¨ã‚¹ãƒ”ãƒŠãƒ¼ -->
        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 mb-6">
            <button id="translateButton" class="btn">ç¿»è¨³ã™ã‚‹</button>
            <button id="copyButton" class="btn bg-green-600 hover:bg-green-700">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
        <div id="loadingSpinner" class="spinner"></div>

        <!-- å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
        <div>
            <label for="outputText" class="block text-xl font-medium mb-3">âœ… ç¿»è¨³çµæœ:</label>
            <textarea id="outputText" rows="6" class="w-full text-lg" readonly placeholder="ç¿»è¨³çµæœã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™..."></textarea>
        </div>
    </div>

    <script>
        // ã“ã“ã«ã‚ãªãŸã®Gemini APIã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
        // GitHub Pagesãªã©ã§å…¬é–‹ã™ã‚‹å ´åˆã€ã“ã®ã‚­ãƒ¼ã¯å…¬é–‹ã•ã‚Œã¾ã™ã€‚
        // é–‹ç™ºå°‚ç”¨ã®ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€æœ¬ç•ªåˆ©ç”¨ã®å ´åˆã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã‚­ãƒ¼ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
        const apiKey = "AIzaSyDCYrSoEDV_fYa78Ev6OraHqH4tNzA7Nrw"; 

        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const translateButton = document.getElementById('translateButton');
        const copyButton = document.getElementById('copyButton');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const instructionMessage = document.getElementById('instructionMessage');

        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.classList.add('show');
        }

        function hideMessageBox() {
            messageBox.classList.remove('show');
        }

        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’è©¦ã¿ã‚‹ï¼ˆå¤–éƒ¨ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã‚ã‚Œã°æ©Ÿèƒ½ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const textToTranslate = urlParams.get('text');

            if (textToTranslate) {
                try {
                    inputText.value = decodeURIComponent(textToTranslate);
                    instructionMessage.classList.add('hidden'); // è‡ªå‹•ã§å…¥ã£ãŸã‚‰æŒ‡ç¤ºã‚’éš ã™
                    // è‡ªå‹•ç¿»è¨³ã‚’é–‹å§‹ï¼ˆGitHub Pagesãªã©å¤–éƒ¨ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãªã‚‰URLæ¸¡ã—ãŒæ©Ÿèƒ½ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰
                    translateText(); 
                } catch (e) {
                    console.error("URI malformed or decoding error:", e);
                    showMessageBox("URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
                    instructionMessage.classList.remove('hidden'); // ã‚¨ãƒ©ãƒ¼ãªã‚‰æ‰‹å‹•ä¿ƒã™
                }
            } else {
                instructionMessage.classList.remove('hidden'); // ãƒ†ã‚­ã‚¹ãƒˆãŒæ¸¡ã•ã‚Œãªã‹ã£ãŸå ´åˆã€æ‰‹å‹•ã§ã®è²¼ã‚Šä»˜ã‘ã‚’ä¿ƒã™
            }
            inputText.focus(); // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹
        });

        async function translateText() {
            // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œç¿»è¨³ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’è¿”ã™ã€æŒ‡ç¤ºã‚’è¿½åŠ 
            const prompt = `ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚ç¿»è¨³ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚å¿…è¦ã«å¿œã˜ã¦ã€æ–‡è„ˆã‚’è€ƒæ…®ã—ã¦è‡ªç„¶ãªè¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚å‰ç½®ãã‚„çµã³ã®è¨€è‘‰ã€è§£èª¬ã€æ³¨æ„æ›¸ãã€è£œè¶³æƒ…å ±ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ã€‚:\n\n"${inputText.value.trim()}"`;
            
            if (!inputText.value.trim()) {
                showMessageBox("ç¿»è¨³ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            // APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯è­¦å‘Š
            if (apiKey === "ã‚ãªãŸã®_Gemini_API_ã‚­ãƒ¼ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„" || !apiKey) {
                showMessageBox("Gemini APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰ã«ã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
                return;
            }

            translateButton.disabled = true;
            copyButton.disabled = true;
            loadingSpinner.classList.add('show');
            outputText.value = 'ç¿»è¨³ä¸­...å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚';
            instructionMessage.classList.add('hidden'); 

            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const translatedText = result.candidates[0].content.parts[0].text;
                    outputText.value = translatedText;
                    copyToClipboard(translatedText);
                    showMessageBox("ç¿»è¨³ãŒå®Œäº†ã—ã€çµæœãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼");
                } else {
                    outputText.value = "ç¿»è¨³ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚APIã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™ã€‚";
                    console.error("API Response Error:", result);
                    showMessageBox("ç¿»è¨³ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                }
            } catch (error) {
                outputText.value = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
                console.error("Translation error:", error);
                showMessageBox("ç¿»è¨³ä¸­ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
            } finally {
                translateButton.disabled = false;
                copyButton.disabled = false;
                loadingSpinner.classList.remove('show');
            }
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                showMessageBox("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                console.error('Failed to copy text:', err);
            } finally {
                document.body.removeChild(textarea);
            }
        }

        translateButton.addEventListener('click', translateText);
        copyButton.addEventListener('click', () => {
            if(outputText.value.trim() !== '') {
                copyToClipboard(outputText.value);
                showMessageBox("ç¿»è¨³çµæœãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼");
            } else {
                showMessageBox("ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
            }
        });
    </script>
</body>
</html>
